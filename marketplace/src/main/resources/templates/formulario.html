
<link rel="stylesheet" href="/css/formulario.css">

<h2>Subir un nuevo trabajo</h2>

<!-- Mensaje de éxito -->
<div id="mensaje" style="display:none; padding: 10px; background-color: #d4edda; color: #155724; border-radius: 5px; margin-bottom: 15px;">
  ¡Trabajo subido con éxito!
</div>

<form id="trabajoForm" action="/registrar-trabajo" method="post">
  <!-- Título -->
  <input type="text" id="titulo" name="titulo" placeholder="Título del trabajo" required minlength="3" maxlength="100" />

  <!-- Descripción -->
  <textarea id="descripcion" name="descripcion" placeholder="Descripción" required maxlength="300"></textarea>
  <small><span id="contador">0</span>/300 caracteres</small>

  <!-- URL de Imagen -->
  <input type="text" id="imagenUrl" name="imagenUrl" placeholder="URL de la imagen" required oninput="mostrarImagen()" />
  <img id="preview" src="" alt="Vista previa" style="max-width: 100%; margin-top: 10px; display: none;" />

  <!-- Categoría -->
  <select id="categoria" name="categoria" required>
    <option value="Diseño Gráfico">Diseño Gráfico</option>
    <option value="Desarrollo Web">Desarrollo Web</option>
    <option value="Ilustraciones">Ilustraciones</option>
  </select>

  <!-- Precio -->
  <input type="number" id="precio" name="precio" placeholder="Precio en soles" required step="0.01" min="0" max="10000" />

  <!-- Número de contacto -->
  <input type="tel" id="numeroContacto" name="numeroContacto" placeholder="Número de contacto" pattern="[0-9]{9}" title="Debe tener 9 dígitos" required />

  <button type="submit">Guardar Trabajo</button>
  <button type="reset" style="margin-top: 10px;">Limpiar</button>
</form>
<script>
  // Contador de caracteres en descripción
  document.getElementById("descripcion").addEventListener("input", function () {
    document.getElementById("contador").textContent = this.value.length;
  });

  // Vista previa de la imagen
  function mostrarImagen() {
    const url = document.getElementById("imagenUrl").value;
    const preview = document.getElementById("preview");
    preview.src = url;
    preview.style.display = url ? "block" : "none";
  }

  // Envío con validación y feedback
  document.getElementById("trabajoForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const precio = parseFloat(document.getElementById("precio").value);
    if (precio < 0 || precio > 10000) {
      alert("Precio inválido. Debe estar entre 0 y 10,000 soles.");
      return;
    }

    const trabajo = {
      titulo: document.getElementById("titulo").value,
      descripcion: document.getElementById("descripcion").value,
      categoria: document.getElementById("categoria").value,
      imagenUrl: document.getElementById("imagenUrl").value,
      precio,
      numeroContacto: document.getElementById("numeroContacto").value
    };

    fetch("/api/trabajos", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(trabajo)
    })
    .then(async response => {
      if (response.ok) {
        document.getElementById("mensaje").style.display = "block";
        document.getElementById("trabajoForm").reset();
        document.getElementById("preview").style.display = "none";
        document.getElementById("contador").textContent = "0";
      } else {
        const errorText = await response.text();
        alert("Error al subir el trabajo: " + errorText);
      }
    })
    .catch(error => {
      alert("Error de red: " + error.message);
      console.error(error);
    });
  });
</script>
